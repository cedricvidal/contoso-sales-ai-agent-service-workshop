# Lab 2 Intro to the Code Interpreter

## Introduction

The Azure AI Agent Service Code Interpreter enables the LLM to generate Python code for tasks such as creating charts or performing complex data analyses based on user queries. It leverages natural language processing (NLP), sales data from an SQLite database, and user prompts to automate code generation. The LLM-generated Python code executes within a secure sandbox environment, utilizing a restricted subset of Python to ensure safe and controlled execution.

## Lab 2 Exercise

In this lab, you will enable the Code Interpreter to execute Python code generated by the LLM.

1. Open the `main.py`.

    **Uncomment** the following lines by removing the `#` character (Note, these lines are **not** consecutive):

    ```python
    # INSTRUCTIONS_FILE = "instructions/instructions_code_interpreter.txt
    # code_interpreter = CodeInterpreterTool()
    # toolset.add(code_interpreter)
    ```

2. Review the code in the `main.py` file.

    After uncommenting, your code should look like this:

    ``` python
    INSTRUCTIONS_FILE = "instructions/instructions_function_calling.txt"
    INSTRUCTIONS_FILE = "instructions/instructions_code_interpreter.txt"
    # INSTRUCTIONS_FILE = "instructions/instructions_code_bing_grounding.txt"


    async def add_agent_tools():
        """Add tools to the agent."""
        toolset.add(functions)

        code_interpreter = CodeInterpreterTool()
        toolset.add(code_interpreter)

        # bing_connection = await project_client.connections.get(connection_name=BING_CONNECTION_NAME)
        # bing_grounding = BingGroundingTool(connection_id=bing_connection.id)
        # toolset.add(bing_grounding)
    ```

### Review the Instructions

Review the **instructions/instructions_code_interpreter.txt** file. This file provides the LLM with specific instructions on how to utilize the Code Interpreter in the **Tools** section.

### Run the Agent Application

1. Press <kbd>F5</kbd> to run the application.
2. In the terminal, the application will start, and the agent app will prompt you to  **Enter your query**.

### Start a Conversation with the Agent

1. Example Query:

   **Show sales by region as a pie chart**.

    - The LLM calls the `async_fetch_sales_data_using_sqlite_query` function to execute a dynamic SQL query on the SQLite database to retrieves the relevant data from the database.
    - The LLM then writes Python code to generate a pie chart based on the data retrieved from the database.
    - Based on the retrieved data, the LLM generates Python code to create a pie chart.
    - The Code Interpreter executes the Python code to create a pie chart.

2. View the Generated Chart:

   - After the task completes, the generated pie chart image will be saved in the src/workshop/files folder.
   - Click on the image to view the pie chart in Visual Studio Code.

3. Download Files:

    Type **Download**

    - This will download the data in CSV format.
    - If you review the instructions, youâ€™ll notice that the default download file format is CSV. However, you can change the file format to JSON or Excel by specifying your preferred format in the query.

    Try typing **Download as JSON**

4. Ask More Questions:

    - Continue asking questions about Contoso sales data to see the Code Interpreter in action.
